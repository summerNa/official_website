<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="icon" type="image/x-icon" href="../favicon.ico" />
  <link rel="stylesheet" href="../css/reset.css">
  <link rel="stylesheet" href="../css/common.css">
  <link rel="stylesheet" href="../css/list.css">
  <link rel="stylesheet" type="text/css" href="../css/bootoast.css">
  <title>小宇矿机</title>
</head>

<body>
  <div class="header_wrap">
    <div class="header">
      <a href="home.html" class="left">
        <img src="../img/common/logo.png" alt="">
      </a>
      <ul class="middle">
        <li>
          <a href="home.html">首页</a>
        </li>
        <li>
          <a href="product.html">产品</a>
        </li>
        <li>
          <a href="introduce.html">关于我们</a>
        </li>
        <li class="actived">
          <a class="list" href="javascript:;">小宇监工</a>
        </li>
      </ul>
      <div class="right">
        <!-- <a class="click_im_area" href="javascript:;">
          <div class="im_box">
            <img src="img/common/yun.png" alt="">
          </div>
          <p class="in">导入</p>
        </a> -->
        <ul class="loginYet">
          <li class="language">
            <a class="en" href="../en1/list.html"><img src="../img/common/zh.png" alt=""></a>
          </li>
          <li class="loginY">
            <a class="usernameAndLogin" href="login.html">登录</a>
          </li>
          <li>
            <div class="line"></div>
          </li>
          <li class="loginY">
            <a class="logoutAndRegister" href="register_phone.html">注册</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="content_wrap">
    <div class="content">
      <div class="top">
        <div class="left">
          <p class="title">设备状态</p>
          <ul>
            <li>
              <p class="num" id="allDevice">0</p>
              <p class="xs_title">玩客设备</p>
            </li>
            <li>
              <p class="num" id="normalDevice">0</p>
              <p class="xs_title">正常状态</p>
            </li>
            <li>
              <p class="num unusual" id="unusualDevice">0</p>
              <p class="xs_title">状态异常</p>
            </li>
            <li>
              <p class="num off" id="offlineDevice">0</p>
              <p class="xs_title">设备离线</p>
            </li>
          </ul>
        </div>
        <div class="right">
          <p class="title">账户情况</p>
          <ul>
            <li>
              <p class="num" id="balance">0</p>
              <p class="xs_title">可提</p>
            </li>
            <li>
              <p class="num" id="extracted">0</p>
              <p class="xs_title">已提</p>
            </li>
          </ul>
        </div>
      </div>
      <div class="middle">
        <p class="title">产量统计</p>
        <div class="con">
          <div>
            <p class="xs_title">昨日产量：<span class="num" id="outYesterday">0</span></p>
            <p class="xs_title">昨日最低：<span class="num" id="minOutYesterday">0</span></p>
          </div>
          <div>
            <p class="xs_title">昨日平均：<span class="num" id="avgOutYesterday">0</span></p>
            <p class="xs_title">本月产量：<span class="num" id="outMonthly">0</span></p>
          </div>
          <div>
            <p class="xs_title">昨日最高：<span class="num" id="maxOutYesterday">0</span></p>
            <p class="xs_title">总产量：<span class="num" id="outTotal">0</span></p>
          </div>
        </div>

      </div>
      <div class="list">
        <p class="title">矿机列表</p>
        <div class="bar">
          <ul id="classify">
            <li class="actived">全部</li>
            <li>正常</li>
            <li>异常</li>
            <li>离线</li>
          </ul>
          <div class="right">
            <div class="input_box">
              <div class="select" id="selectbox1">
                <p id="selectValue">分组</p>
                <span class="jiao"></span>
              </div>
              <div class="option hide" id="group">
                <!-- <p>小组1</p>
                <p>小组2</p> -->
              </div>
              <input type="text" class="inputArea" placeholder="搜索">
              <p class="sousuo"></p>
            </div>
          </div>
        </div>
        <div class="bar bar2">
          <p><span id="barAll">0</span>台，昨日 <span id="barYest">0</span>，平均 <span id="barAvg">0</span>，可提 <span id="barAgree">0</span></p>
          <div class="addDevice">添加设备</div>
        </div>
        <div class="bar bar3">
          <ul>
            <li class="fenzu" dir="up">分组<img class="arrow" src="" alt=""></li>
            <li class="mingcheng" dir="up">名称<img class="arrow" src="" alt=""></li>
            <li class="chanliang" dir="up">产量<img class="arrow" src="" alt=""></li>
            <li class="keti" dir="up">可提<img class="arrow" src="" alt=""></li>
          </ul>
          <ul class="search">
            <li class="boxBtn" id="allCoin">
              提币
            </li>
            <li class="boxBtn" id="allStart">
              刷新
            </li>
          </ul>
        </div>
        <div class="info">
          <ul>
            <li class="listCon">
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <!-- modal -->
  <div class="modal">
    <div class="modal-body">
      <ul class="select">
        <li class="se picks">提取链克</li>
        <li class="se changeName">设备改名</li>
        <li class="se changeGroup">设备分组</li>
        <li class="cd_pop">弹出磁盘</li>
        <li class="restart_device">重启设备</li>
        <li class="delete_device">删除设备</li>
      </ul>
      <div class="inputName none">
        <p>设备改名</p>
        <div class="inputArea">
          <input class="inputr" type="text" placeholder="请输入新的名称">
        </div>
        <div class="btn-group">
          <button class="reset reset">取消</button>
          <button class="sure sure">确定</button>
        </div>
      </div>
      <div class="groupBox none">
        <p>选择分组</p>
        <ul class="selectArea">
        </ul>
        <div class="btn-group">
          <button class="selectReset">取消</button>
          <button class="selectSure">确定</button>
        </div>
      </div>
    </div>
  </div>
</body>
<script src="../js/jquery-1.9.1.min.js"></script>
<script src="../js/common.js"></script>
<script src="../js/pinyin2.js"></script>
<script type="text/javascript" src="../js/bootoast.js"></script>
<script>
  $(document).ready(function () {

    var whdef = 100 / 1920; // 表示1920的设计图,使用100PX的默认值
    var wH = window.innerHeight; // 当前窗口的高度
    var wW = window.innerWidth; // 当前窗口的宽度
    var rem = wW * whdef; // 以默认比例值乘以当前窗口宽度,得到该宽度下的相应FONT-SIZE值
    $('html').css('font-size', rem + "px");

    $(window).resize(function () {
      wH = window.innerHeight;
      wW = window.innerWidth;
      rem = wW * whdef;
      $('html').css('font-size', rem + "px");
    });

    is_all = 1;
    state = '';
    group_id = -1;

    arrList = [];

    params = encodeURI('{"monitor_userid":"' + isLogin.userid + '","session_id":"' + isLogin.session_id + '"}');
    $.ajax({
      url: 'http://api.xiaoyu.chat/live/Devicesumary/getTheDeviceSumary?header={"os{"os":"web","reqtime":"1538121291086","sign":"","v"}&body=' + params,
      type: 'GET',
      dataType: 'JSON',
      beforeSend: function (request) {
      },
      success: function (data) {
        if (data.header.retStatus !== 200) {
        } else {
          $('#allDevice').text(data.body.sumary_data.state_sumary.deviceNum);
          $('#normalDevice').text(data.body.sumary_data.state_sumary.onlineNum);
          $('#unusualDevice').text(data.body.sumary_data.state_sumary.exceptionNum);
          $('#offlineDevice').text(data.body.sumary_data.state_sumary.offlineNum);

          $('#balance').text(data.body.sumary_data.withdraw_sumary.balance.toFixed(2));
          $('#extracted').text(data.body.sumary_data.withdraw_sumary.extracted.toFixed(2));

          $('#outYesterday').text(data.body.sumary_data.output_statistics.outputYesterday.toFixed(2));
          $('#minOutYesterday').text(data.body.sumary_data.output_statistics.minOutputYesterday.toFixed(2));
          $('#avgOutYesterday').text(data.body.sumary_data.output_statistics.avgOutputYesterday.toFixed(2));
          $('#outMonthly').text(data.body.sumary_data.output_statistics.outputMonthly.toFixed(2));
          $('#maxOutYesterday').text(data.body.sumary_data.output_statistics.maxOutputYesterday.toFixed(2));
          $('#outTotal').text(data.body.sumary_data.output_statistics.outputTotal.toFixed(2));
        }
      },
      error: function (error) {
        console.log('error');
      }
    });

    // 获取用户名下的分组
    $.ajax({
      url: 'http://api.xiaoyu.chat/live/Devicemanager/getDeviceGroup?header={"os{"os":"web","reqtime":"1538121291086","sign":"","v"}&body=' + params,
      type: 'GET',
      dataType: 'JSON',
      beforeSend: function (request) {
      },
      success: function (data) {
        if (data.header.retStatus !== 200) {
        } else {
          var groups = '';
          var selectGroups = '';
          for (var i = 0; i < data.body.group_list.length; i++) {
            groups += '<p class="gr" id="' + data.body.group_list[i].group_id + '">' + data.body.group_list[i].group_name + '</p>';
            selectGroups += '<li><p>' + data.body.group_list[i].group_name + '</p><input data-groupname="' + data.body.group_list[i].group_name + '" name="select" type="radio" value="' + data.body.group_list[i].group_id + '"></li>';
          }
          $('#group').append(groups);
          $('.selectArea').append(selectGroups);
        }
      },
      error: function (error) {
        console.log('error');
      }
    });

    params2 = encodeURI('{"monitor_userid":"' + isLogin.userid + '","session_id":"' + isLogin.session_id + '","is_all":1}');
    getList();

    $('#classify li').on('click', function () {
      is_all = 0;
      $(this).addClass('actived').siblings().removeClass('actived');
      if ($(this).text() === '正常') {
        state = 'online';
      } else if ($(this).text() === '异常') {
        state = 'exception';
      } else if ($(this).text() === '离线') {
        state = 'offline';
      } else {
        is_all = 1;
      }
      params2 = encodeURI('{"monitor_userid":"' + isLogin.userid + '","session_id":"' + isLogin.session_id + '","is_all":"' + is_all + '","state":"' + state + '"}');
      getList();
    });

    $("#group").on('click', '.gr', function () {
      $("#group").addClass('hide');
      group_id = $(this).attr('id');
      if (is_all === 1) {
        params2 = encodeURI('{"monitor_userid":"' + isLogin.userid + '","session_id":"' + isLogin.session_id + '","is_all":"0","state":"' + state + '","group_id":"' + group_id + '"}');
      } else {
        params2 = encodeURI('{"monitor_userid":"' + isLogin.userid + '","session_id":"' + isLogin.session_id + '","is_all":"' + is_all + '","state":"' + state + '","group_id":"' + group_id + '"}');
      }

      getList();
    });

    $(".sousuo").on('click', function () {
      if (is_all === 1) {
        params2 = encodeURI('{"monitor_userid":"' + isLogin.userid + '","session_id":"' + isLogin.session_id + '","is_all":"0","state":"' + state + '","group_id":"' + group_id + '","key_word": "' + $('.inputArea').val() + '"}');
      } else {
        params2 = encodeURI('{"monitor_userid":"' + isLogin.userid + '","session_id":"' + isLogin.session_id + '","is_all":"' + is_all + '","state":"' + state + '","group_id":"' + group_id + '","key_word": "' + $('.inputArea').val() + '"}');
      }

      $('.inputArea').val('');
      getList();
    });

    function getList() {
      $('.arrow').attr('src', '');
      $.ajax({
        url: 'http://api.xiaoyu.chat/live/Devicemanager/getDeviceList?header={"os":"web","reqtime":"1538121291086","sign":"","v"}&body=' + params2,
        type: 'GET',
        dataType: 'JSON',
        beforeSend: function (request) {
        },
        success: function (data) {
          if (data.header.retStatus !== 200) {
          } else {
            $('#barAll').text(data.body.device_info.sumary_data.device_count);
            $('#barAvg').text(data.body.device_info.sumary_data.avg_output.toFixed(2));
            $('#barYest').text(data.body.device_info.sumary_data.yes_wkb.toFixed(2));
            $('#barAgree').text(data.body.device_info.sumary_data.balance.toFixed(2));
            var content = '';
            if (data.body.device_info.hasOwnProperty('device_list')) {
              arrList = data.body.device_info.device_list;
              for (var i = 0; i < data.body.device_info.device_list.length; i++) {
                yes_wkb = Number(data.body.device_info.device_list[i].yes_wkb).toFixed(2);
                before_day = Number(data.body.device_info.device_list[i].before_day).toFixed(2);
                balance = Number(data.body.device_info.device_list[i].balance).toFixed(2);
                if (data.body.device_info.device_list[i].status === 'offline') {
                  sta = '离线';
                  classname = 'grey status'
                } else if (data.body.device_info.device_list[i].status === 'online') {
                  sta = '正常';
                  classname = 'status';
                } else {
                  sta = '异常';
                  classname = 'red status'
                }
                if (!data.body.device_info.device_list[i].disk_info.length) {
                  used = 0;
                  all = 0;
                } else {
                  used = (Number(data.body.device_info.device_list[i].disk_info[0].used) / 1024 / 1024 / 1024).toFixed() + 'G';
                  all = (Number(data.body.device_info.device_list[i].disk_info[0].capacity) / 1024 / 1024 / 1024).toFixed() + 'G';
                }
                day = ((Number(Date.parse(new Date()) / 1000) - Number(data.body.device_info.device_list[i].features.onecloud_coin)) / 3600 / 24).toFixed();
                content += '<div class="pick"><div class="up"><p class="name">' + data.body.device_info.device_list[i].device_name
                  + '<span class="status2">' + data.body.device_info.device_list[i].group_name
                  + '<span class="' + classname + '">' + sta + '</span></p><div class="money"><p class="left">昨天：<span>' + yes_wkb + '</span>前天：<span>' + before_day + '</span>余额：<span>' + balance
                  + '</span></p><div class="right"><div class="statistics" data-username="' + data.body.device_info.device_list[i].device_name + '" data-id="' + data.body.device_info.device_list[i].userid + '"><img src="../img/common/tongji.png">统计</div><div class="operate" data-groupid="' + data.body.device_info.device_list[i].group_id + '" data-id="' + data.body.device_info.device_list[i].userid + '"><img src="../img/common/caozuo.png">操作</div></div></div></div><div class="down none"><div class="line"><p>SN:<span>' + data.body.device_info.device_list[i].device_sn
                  + '</span></p><p>' + used + '/' + all + '</p></div><div class="line"><p>账号:<span>' + data.body.device_info.device_list[i].wky_account + '</span></p><p>激活天数:<span>' + day +
                  '</span></p></div><div class="line"><p>IP:<span>' + data.body.device_info.device_list[i].ip + '</span></p></div></div></div>';
              }
              $('.listCon').empty();
              $('.listCon').append(content);
            } else {
              $('.listCon').empty();
              arrList = [];
            }

          }
        },
        error: function (error) {
          console.log('error');
        }
      });
    }

    // 提币
    $("#allCoin").on('click', function () {
      params4 = encodeURI('{"monitor_userid":"' + isLogin.userid + '","session_id":"' + isLogin.session_id + '","is_all":1}');
      $.ajax({
        url: 'http://api.xiaoyu.chat/live/Devicemanager/drawCoin?header={"os{"os":"web","reqtime":"1538121291086","sign":"","v"}&body=' + params4,
        type: 'GET',
        dataType: 'JSON',
        beforeSend: function (request) {
        },
        success: function (data) {
          if (data.header.retStatus !== 200) {
            bootoast({
              type: 'success',
              message: data.header.retMessage,
              position: 'top-center',
              timeout: true,
              animationDuration: 300
            });
          } else {
            bootoast({
              type: 'success',
              message: '提币成功！',
              position: 'top-center',
              timeout: true,
              animationDuration: 300
            });
          }
        },
        error: function (error) {
          console.log('error');
        }
      });
    });

    // 刷新
    $("#allStart").on('click', function () {
      params4 = encodeURI('{"monitor_userid":"' + isLogin.userid + '","session_id":"' + isLogin.session_id + '"}');
      $.ajax({
        url: 'http://api.xiaoyu.chat/live/Devicemanager/refreshDevice?header={"os{"os":"web","reqtime":"1538121291086","sign":"","v"}&body=' + params4,
        type: 'GET',
        dataType: 'JSON',
        beforeSend: function (request) {
        },
        success: function (data) {
          if (data.header.retStatus !== 200) {
            bootoast({
              type: 'success',
              message: data.header.retMessage,
              position: 'top-center',
              timeout: true,
              animationDuration: 300
            });
          } else {
            bootoast({
              type: 'success',
              message: '刷新成功！',
              position: 'top-center',
              timeout: true,
              animationDuration: 300
            });
          }
        },
        error: function (error) {
          console.log('error');
        }
      });
    });

    // sort 下
    function compare1(property) {
      return function (a, b) {
        var value1 = a[property];
        var value2 = b[property];
        return value1 - value2;
      }
    }
    // sort 上
    function compare2(property) {
      return function (a, b) {
        var value1 = a[property];
        var value2 = b[property];
        return value2 - value1;
      }
    }

    //定义一个比较器 
    function compare3(propertyName) {
      return function (object1, object2) {
        var value1 = object1[propertyName];
        var value2 = object2[propertyName];
        if (ConvertPinyin(value2) < ConvertPinyin(value1)) {
          return -1;
        }
        else if (ConvertPinyin(value2) > ConvertPinyin(value1)) {
          return 1;
        }
        else {
          return 0;
        }
      }
    }

    //定义一个比较器 
    function compare4(propertyName) {
      return function (object1, object2) {
        var value1 = object1[propertyName];
        var value2 = object2[propertyName];
        if (ConvertPinyin(value2) > ConvertPinyin(value1)) {
          return -1;
        }
        else if (ConvertPinyin(value2) < ConvertPinyin(value1)) {
          return 1;
        }
        else {
          return 0;
        }
      }
    }

    $('.fenzu').on('click', function () {
      console.log(arrList)
      if ($(this).attr('dir') === 'up') {
        $(this).attr('dir', 'down');
        $(this).siblings().children('.arrow').attr('src', '');
        $(this).children('.arrow').attr('src', '../img/common/up.jpg');
        arrList.sort(compare4('group_name'));
      } else {
        $(this).attr('dir', 'up');
        $(this).siblings().children('.arrow').attr('src', '');
        $(this).children('.arrow').attr('src', '../img/common/down2.jpg')
        arrList.sort(compare3('group_name'));
      }
      var content = '';
      for (var i = 0; i < arrList.length; i++) {
        yes_wkb = Number(arrList[i].yes_wkb).toFixed(2);
        before_day = Number(arrList[i].before_day).toFixed(2);
        balance = Number(arrList[i].balance).toFixed(2);
        if (arrList[i].status === 'offline') {
          sta = '离线';
          classname = 'grey status'
        } else if (arrList[i].status === 'online') {
          sta = '正常';
          classname = 'status';
        } else {
          sta = '异常';
          classname = 'red status'
        }
        if (!arrList[i].disk_info.length) {
          used = 0;
          all = 0;
        } else {
          used = (Number(arrList[i].disk_info[0].used) / 1024 / 1024 / 1024).toFixed() + 'G';
          all = (Number(arrList[i].disk_info[0].capacity) / 1024 / 1024 / 1024).toFixed() + 'G';
        }
        day = ((Number(Date.parse(new Date()) / 1000) - Number(arrList[i].features.onecloud_coin)) / 3600 / 24).toFixed();
        content += '<div class="pick"><div class="up"><p class="name">' + arrList[i].device_name
          + '<span class="status2">' + arrList[i].group_name
          + '<span class="' + classname + '">' + sta + '</span></p><div class="money"><p class="left">昨天：<span>' + yes_wkb + '</span>前天：<span>' + before_day + '</span>余额：<span>' + balance
          + '</span></p><div class="right"><div class="statistics" data-username="' + arrList[i].device_name + '" data-id="' + arrList[i].userid + '"><img src="../img/common/tongji.png">统计</div><div class="operate" data-groupid="' + arrList[i].group_id + '" data-id="' + arrList[i].userid + '"><img src="../img/common/caozuo.png">操作</div></div></div></div><div class="down none"><div class="line"><p>SN:<span>' + arrList[i].device_sn
          + '</span></p><p>' + used + '/' + all + '</p></div><div class="line"><p>账号:<span>' + arrList[i].wky_account + '</span></p><p>激活天数:<span>' + day +
          '</span></p></div><div class="line"><p>IP:<span>' + arrList[i].ip + '</span></p></div></div></div>';
      }
      $('.listCon').empty();
      $('.listCon').append(content);
    });

    $('.mingcheng').on('click', function () {
      if ($(this).attr('dir') === 'up') {
        $(this).attr('dir', 'down');
        $(this).siblings().children('.arrow').attr('src', '');
        $(this).children('.arrow').attr('src', '../img/common/up.jpg');
        arrList.sort(compare4('device_name'));
      } else {
        $(this).attr('dir', 'up');
        $(this).siblings().children('.arrow').attr('src', '');
        $(this).children('.arrow').attr('src', '../img/common/down2.jpg');
        arrList.sort(compare3('device_name'));
      }
      var content = '';
      for (var i = 0; i < arrList.length; i++) {
        yes_wkb = Number(arrList[i].yes_wkb).toFixed(2);
        before_day = Number(arrList[i].before_day).toFixed(2);
        balance = Number(arrList[i].balance).toFixed(2);
        if (arrList[i].status === 'offline') {
          sta = '离线';
          classname = 'grey status'
        } else if (arrList[i].status === 'online') {
          sta = '正常';
          classname = 'status';
        } else {
          sta = '异常';
          classname = 'red status'
        }
        if (!arrList[i].disk_info.length) {
          used = 0;
          all = 0;
        } else {
          used = (Number(arrList[i].disk_info[0].used) / 1024 / 1024 / 1024).toFixed() + 'G';
          all = (Number(arrList[i].disk_info[0].capacity) / 1024 / 1024 / 1024).toFixed() + 'G';
        }
        day = ((Number(Date.parse(new Date()) / 1000) - Number(arrList[i].features.onecloud_coin)) / 3600 / 24).toFixed();
        content += '<div class="pick"><div class="up"><p class="name">' + arrList[i].device_name
          + '<span class="status2">' + arrList[i].group_name
          + '<span class="' + classname + '">' + sta + '</span></p><div class="money"><p class="left">昨天：<span>' + yes_wkb + '</span>前天：<span>' + before_day + '</span>余额：<span>' + balance
          + '</span></p><div class="right"><div class="statistics" data-username="' + arrList[i].device_name + '" data-id="' + arrList[i].userid + '"><img src="../img/common/tongji.png">统计</div><div class="operate" data-groupid="' + arrList[i].group_id + '" data-id="' + arrList[i].userid + '"><img src="../img/common/caozuo.png">操作</div></div></div></div><div class="down none"><div class="line"><p>SN:<span>' + arrList[i].device_sn
          + '</span></p><p>' + used + '/' + all + '</p></div><div class="line"><p>账号:<span>' + arrList[i].wky_account + '</span></p><p>激活天数:<span>' + day +
          '</span></p></div><div class="line"><p>IP:<span>' + arrList[i].ip + '</span></p></div></div></div>';
      }
      $('.listCon').empty();
      $('.listCon').append(content);
    });


    $('.keti').on('click', function () {
      if ($(this).attr('dir') === 'up') {
        $(this).attr('dir', 'down');
        $(this).siblings().children('.arrow').attr('src', '');
        $(this).children('.arrow').attr('src', '../img/common/up.jpg');
        arrList.sort(compare2('balance'));
      } else {
        $(this).attr('dir', 'up');
        $(this).siblings().children('.arrow').attr('src', '');
        $(this).children('.arrow').attr('src', '../img/common/down2.jpg');
        arrList.sort(compare1('balance'));
      }
      var content = '';
      for (var i = 0; i < arrList.length; i++) {
        yes_wkb = Number(arrList[i].yes_wkb).toFixed(2);
        before_day = Number(arrList[i].before_day).toFixed(2);
        balance = Number(arrList[i].balance).toFixed(2);
        if (arrList[i].status === 'offline') {
          sta = '离线';
          classname = 'grey status'
        } else if (arrList[i].status === 'online') {
          sta = '正常';
          classname = 'status';
        } else {
          sta = '异常';
          classname = 'red status'
        }
        if (!arrList[i].disk_info.length) {
          used = 0;
          all = 0;
        } else {
          used = (Number(arrList[i].disk_info[0].used) / 1024 / 1024 / 1024).toFixed() + 'G';
          all = (Number(arrList[i].disk_info[0].capacity) / 1024 / 1024 / 1024).toFixed() + 'G';
        }
        day = ((Number(Date.parse(new Date()) / 1000) - Number(arrList[i].features.onecloud_coin)) / 3600 / 24).toFixed();
        content += '<div class="pick"><div class="up"><p class="name">' + arrList[i].device_name
          + '<span class="status2">' + arrList[i].group_name
          + '<span class="' + classname + '">' + sta + '</span></p><div class="money"><p class="left">昨天：<span>' + yes_wkb + '</span>前天：<span>' + before_day + '</span>余额：<span>' + balance
          + '</span></p><div class="right"><div class="statistics" data-username="' + arrList[i].device_name + '" data-id="' + arrList[i].userid + '"><img src="../img/common/tongji.png">统计</div><div class="operate" data-groupid="' + arrList[i].group_id + '" data-id="' + arrList[i].userid + '"><img src="../img/common/caozuo.png">操作</div></div></div></div><div class="down none"><div class="line"><p>SN:<span>' + arrList[i].device_sn
          + '</span></p><p>' + used + '/' + all + '</p></div><div class="line"><p>账号:<span>' + arrList[i].wky_account + '</span></p><p>激活天数:<span>' + day +
          '</span></p></div><div class="line"><p>IP:<span>' + arrList[i].ip + '</span></p></div></div></div>';
      }
      $('.listCon').empty();
      $('.listCon').append(content);
    });

    $('.chanliang').on('click', function () {
      if ($(this).attr('dir') === 'up') {
        $(this).attr('dir', 'down');
        $(this).siblings().children('.arrow').attr('src', '');
        $(this).children('.arrow').attr('src', '../img/common/up.jpg');
        arrList.sort(compare2('yes_wkb'));
      } else {
        $(this).attr('dir', 'up');
        $(this).siblings().children('.arrow').attr('src', '');
        $(this).children('.arrow').attr('src', '../img/common/down2.jpg');
        arrList.sort(compare1('yes_wkb'));
      }
      var content = '';
      for (var i = 0; i < arrList.length; i++) {
        yes_wkb = Number(arrList[i].yes_wkb).toFixed(2);
        before_day = Number(arrList[i].before_day).toFixed(2);
        balance = Number(arrList[i].balance).toFixed(2);
        if (arrList[i].status === 'offline') {
          sta = '离线';
          classname = 'grey status'
        } else if (arrList[i].status === 'online') {
          sta = '正常';
          classname = 'status';
        } else {
          sta = '异常';
          classname = 'red status'
        }
        if (!arrList[i].disk_info.length) {
          used = 0;
          all = 0;
        } else {
          used = (Number(arrList[i].disk_info[0].used) / 1024 / 1024 / 1024).toFixed() + 'G';
          all = (Number(arrList[i].disk_info[0].capacity) / 1024 / 1024 / 1024).toFixed() + 'G';
        }
        day = ((Number(Date.parse(new Date()) / 1000) - Number(arrList[i].features.onecloud_coin)) / 3600 / 24).toFixed();
        content += '<div class="pick"><div class="up"><p class="name">' + arrList[i].device_name
          + '<span class="status2">' + arrList[i].group_name
          + '<span class="' + classname + '">' + sta + '</span></p><div class="money"><p class="left">昨天：<span>' + yes_wkb + '</span>前天：<span>' + before_day + '</span>余额：<span>' + balance
          + '</span></p><div class="right"><div class="statistics" data-username="' + arrList[i].device_name + '" data-id="' + arrList[i].userid + '"><img src="../img/common/tongji.png">统计</div><div class="operate" data-groupid="' + arrList[i].group_id + '" data-id="' + arrList[i].userid + '"><img src="../img/common/caozuo.png">操作</div></div></div></div><div class="down none"><div class="line"><p>SN:<span>' + arrList[i].device_sn
          + '</span></p><p>' + used + '/' + all + '</p></div><div class="line"><p>账号:<span>' + arrList[i].wky_account + '</span></p><p>激活天数:<span>' + day +
          '</span></p></div><div class="line"><p>IP:<span>' + arrList[i].ip + '</span></p></div></div></div>';
      }
      $('.listCon').empty();
      $('.listCon').append(content);
    });

    // dropDown
    $(".listCon").on('click', '.up', function () {
      $(this).next(".down").toggle();
      $(this).parent().siblings().children('.down').hide();
    });

    $("#selectbox1").on('click', function () {
      $("#group").removeClass('hide');
    });


    // 添加设备
    $('.addDevice').on('click', function () {
      window.open("import.html");
    });

    // 操作
    $(".listCon").on("click", ".operate", function (e) {
      userid = $(this).attr('data-id');
      groupid = $(this).attr('data-groupid');
      groupname = $(this).attr('data-groupname');
      $('.modal').addClass('show');
      e.stopPropagation();
    });

    // 统计
    $(".listCon").on("click", ".statistics", function (e) {
      userid = $(this).attr('data-id');
      username = $(this).attr('data-username');
      window.location.href = 'statistics.html?userid=' + userid +'&username='+username;
      e.stopPropagation();
    });

    // 磁盘弹出
    $('.cd_pop').on('click', function () {
      params = encodeURI('{"monitor_userid":"' + isLogin.userid + '","session_id":"' + isLogin.session_id + '","device_userid":"' + userid + '"}');
      $.ajax({
        url: 'http://api.xiaoyu.chat/live/Devicemanager/unmountUsb?header={"os{"os":"web","reqtime":"1538121291086","sign":"","v"}&body=' + params,
        type: 'GET',
        dataType: 'JSON',
        beforeSend: function (request) {
        },
        success: function (data) {
          $('.modal').removeClass('show');
          if (data.header.retStatus !== 200) {
            bootoast({
              type: 'success',
              message: data.header.retMessage,
              position: 'top-center',
              timeout: true,
              animationDuration: 300
            });
          } else {
            bootoast({
              type: 'success',
              message: '弹出成功！',
              position: 'top-center',
              timeout: true,
              animationDuration: 300
            });

          }
        },
        error: function (error) {
          console.log('error');
        }
      });
    });

    // 重启设备
    $('.restart_device').on('click', function () {
      params = encodeURI('{"monitor_userid":"' + isLogin.userid + '","session_id":"' + isLogin.session_id + '","device_userid":"' + userid + '"}');
      $.ajax({
        url: 'http://api.xiaoyu.chat/live/Devicemanager/rebootDevice?header={"os{"os":"web","reqtime":"1538121291086","sign":"","v"}&body=' + params,
        type: 'GET',
        dataType: 'JSON',
        beforeSend: function (request) {
        },
        success: function (data) {
          $('.modal').removeClass('show');
          if (data.header.retStatus !== 200) {
            bootoast({
              type: 'success',
              message: data.header.retMessage,
              position: 'top-center',
              timeout: true,
              animationDuration: 300
            });
          } else {
            bootoast({
              type: 'success',
              message: '重启成功！',
              position: 'top-center',
              timeout: true,
              animationDuration: 300
            });
          }
        },
        error: function (error) {
          console.log('error');
        }
      });
    });

    // 删除设备
    $('.delete_device').on('click', function () {
      params = encodeURI('{"monitor_userid":"' + isLogin.userid + '","session_id":"' + isLogin.session_id + '","device_userid":"' + userid + '"}');
      $.ajax({
        url: 'http://api.xiaoyu.chat/live/Devicemanager/removeDevice?header={"os{"os":"web","reqtime":"1538121291086","sign":"","v"}&body=' + params,
        type: 'GET',
        dataType: 'JSON',
        beforeSend: function (request) {
        },
        success: function (data) {
          $('.modal').removeClass('show');
          if (data.header.retStatus !== 200) {
            bootoast({
              type: 'success',
              message: data.header.retMessage,
              position: 'top-center',
              timeout: true,
              animationDuration: 300
            });
          } else {
            params2 = encodeURI('{"monitor_userid":"' + isLogin.userid + '","session_id":"' + isLogin.session_id + '","is_all":1}');
            getList();
            bootoast({
              type: 'success',
              message: '删除成功！',
              position: 'top-center',
              timeout: true,
              animationDuration: 300
            });
          }
        },
        error: function (error) {
          console.log('error');
        }
      });
    });

    // 提取链克
    $('.picks').on('click', function () {
      params = encodeURI('{"monitor_userid":"' + isLogin.userid + '","session_id":"' + isLogin.session_id + '","device_userid":"' + userid + '"}');
      $.ajax({
        url: 'http://api.xiaoyu.chat/live/Devicemanager/drawCoin?header={"os{"os":"web","reqtime":"1538121291086","sign":"","v"}&body=' + params,
        type: 'GET',
        dataType: 'JSON',
        beforeSend: function (request) {
        },
        success: function (data) {
          $('.modal').removeClass('show');
          if (data.header.retStatus !== 200) {
            bootoast({
              type: 'success',
              message: data.header.retMessage,
              position: 'top-center',
              timeout: true,
              animationDuration: 300
            });
          } else {
            bootoast({
              type: 'success',
              message: '提取成功！',
              position: 'top-center',
              timeout: true,
              animationDuration: 300
            });
          }
        },
        error: function (error) {
          console.log('error');
        }
      });
    });

    // 提取链克
    $('.changeName').on('click', function () {
      $('.select').addClass('none');
      $('.inputName').removeClass('none');

    });

    // 提取链克
    $('.changeGroup').on('click', function () {
      $('.select').addClass('none');
      $('.groupBox').removeClass('none');
    });


    // 确定
    $('.sure').on('click', function () {
      if ($('.inputr').val()) {
        params = encodeURI('{"monitor_userid":"' + isLogin.userid + '","session_id":"' + isLogin.session_id + '","device_userid":"' + userid + '","device_name":"' + $('.inputr').val() + '"}');
        $.ajax({
          url: 'http://api.xiaoyu.chat/live/Devicemanager/renameDevice?header={"os{"os":"web","reqtime":"1538121291086","sign":"","v"}&body=' + params,
          type: 'GET',
          dataType: 'JSON',
          beforeSend: function (request) {
          },
          success: function (data) {
            $('.modal').removeClass('show');
            $('.inputName').addClass('none');
            $('.select').removeClass('none');
            if (data.header.retStatus !== 200) {
              bootoast({
                type: 'success',
                message: data.header.retMessage,
                position: 'top-center',
                timeout: true,
                animationDuration: 300
              });
            } else {
              params2 = encodeURI('{"monitor_userid":"' + isLogin.userid + '","session_id":"' + isLogin.session_id + '","is_all":1}');
              getList();
            }
          },
          error: function (error) {
            console.log('error');
            $('.modal').removeClass('show');
            $('.inputName').addClass('none');
            $('.select').removeClass('none');
          }
        });
      } else {
        $('.modal').removeClass('show');
        $('.inputName').addClass('none');
        $('.select').removeClass('none');
      }
    });

    // 取消
    $('.reset').on('click', function () {
      $('.modal').removeClass('show');
      $('.inputName').addClass('none');
      $('.select').removeClass('none');
    });

    // 分组确定
    $('.selectSure').on('click', function () {
      newId = $("input[type='radio']:checked").val();
      newname = $("input[type='radio']:checked").attr('data-groupname');
      if (newId) {
        params = encodeURI('{"monitor_userid":"' + isLogin.userid + '","session_id":"' + isLogin.session_id + '","device_userid":"' + userid + '","new_group_id":"' + newId + '","old_group_id":"' + groupid + '","new_group_name":"' + newname + '"}');
        $.ajax({
          url: 'http://api.xiaoyu.chat/live/Devicemanager/setDeviceGroup?header={"os{"os":"web","reqtime":"1538121291086","sign":"","v"}&body=' + params,
          type: 'GET',
          dataType: 'JSON',
          beforeSend: function (request) {
          },
          success: function (data) {
            $('.modal').removeClass('show');
            $('.inputName').addClass('none');
            $('.select').removeClass('none');
            $('.groupBox').addClass('none');
            if (data.header.retStatus !== 200) {
              bootoast({
                type: 'success',
                message: data.header.retMessage,
                position: 'top-center',
                timeout: true,
                animationDuration: 300
              });
            } else {
              params2 = encodeURI('{"monitor_userid":"' + isLogin.userid + '","session_id":"' + isLogin.session_id + '","is_all":1}');
              getList();
            }
          },
          error: function (error) {
            console.log('error');
            $('.modal').removeClass('show');
            $('.inputName').addClass('none');
            $('.select').removeClass('none');
            $('.groupBox').addClass('none');
          }
        });
      } else {
        $('.modal').removeClass('show');
        $('.inputName').addClass('none');
        $('.select').removeClass('none');
        $('.groupBox').addClass('none');
      }
    });

    // 取消
    $('.selectReset').on('click', function () {
      $('.modal').removeClass('show');
      $('.inputName').addClass('none');
      $('.select').removeClass('none');
      $('.groupBox').addClass('none');
    });

    $('.modal').on('click', function () {
      $('.modal').removeClass('show');
      $('.inputName').addClass('none');
      $('.select').removeClass('none');
      $('.groupBox').addClass('none');
    })

    $('.modal-body').on('click', function (e) {
      e.stopPropagation();
    })

  })

</script>

</html>